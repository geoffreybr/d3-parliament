d3.parliament=function(){function t(t){t.each(function(t){n=n||this.getBoundingClientRect().width,e=n?n/2:this.getBoundingClientRect().width/2;var c=Math.min(n/2,e),s=c*a,f=d3.select(this),m=0;t.forEach(function(t){m+="number"==typeof t.seats?Math.floor(t.seats):t.seats.length});var h=0,d=0,g=.5;!function(){for(var t=a/(1-a);d<m;)h++,g+=t,d=r(function(t){return Math.floor(Math.PI*(g+t))},h-1)}();var p=(c-s)/h,v=[];!function(){for(var t=d-m,r=0;r<h;r++)for(var n=s+p*(r+.5),e=Math.floor(Math.PI*(g+r))-Math.floor(t/h)-(t%h>r?1:0),a=Math.PI/e,o=0;o<e;o++){var i={};i.polar={r:n,teta:-Math.PI+a*(o+.5)},i.cartesian={x:i.polar.r*Math.cos(i.polar.teta),y:i.polar.r*Math.sin(i.polar.teta)},v.push(i)}}(),v.sort(function(t,r){return t.polar.teta-r.polar.teta||r.polar.r-t.polar.r});var C=0;!function(){var r=0;v.forEach(function(n){var e=t[C],a="number"==typeof e.seats?e.seats:e.seats.length;r>=a&&(C++,r=0,e=t[C]),n.party=e,n.data="number"==typeof e.seats?null:e.seats[r],r++})}(),o.domain(t.map(function(t){return t.legend}));var y=function(t){var r="seat ";return r+=t.party&&t.party.id||"",r.trim()},M=function(t){return t.cartesian.x},T=function(t){return t.cartesian.y},b=function(t){var r=.4*p;return t.data&&"number"==typeof t.data.size&&(r*=t.data.size),r},x=function(t){return o(t.party.legend)},B=f.select(".parliament");B.empty()&&(B=f.append("g"),B.classed("parliament",!0)),B.attr("transform","translate("+n/2+","+c+")");var S=B.selectAll(".seat").data(v);S.attr("class",y);var w=S.enter().append("circle");if(w.attr("class",y),w.attr("cx",i.fromCenter?0:M),w.attr("cy",i.fromCenter?0:T),w.attr("r",i.smallToBig?0:b),w.attr("fill",x),i.fromCenter||i.smallToBig){var I=w.transition().duration(function(){return 1e3+800*Math.random()});i.fromCenter&&(I.attr("cx",M),I.attr("cy",T)),i.smallToBig&&I.attr("r",b)}for(var P in u._)!function(t){w.on(t,function(r){u.call(t,this,r)})}(P);if(S.transition().duration(function(){return 1e3+800*Math.random()}).attr("cx",M).attr("cy",T).attr("r",b),l.toCenter||l.bigToSmall){var I=S.exit().transition().duration(function(){return 1e3+800*Math.random()});l.toCenter&&I.attr("cx",0).attr("cy",0),l.bigToSmall&&I.attr("r",0),I.remove()}else S.exit().remove()})}function r(t,r){for(var n=0,e=0;e<=r;e++)n+=t(e);return n}var n,e,a=.4,o=d3.scaleOrdinal(d3.schemeCategory10),i={smallToBig:!0,fromCenter:!0},l={bigToSmall:!0,toCenter:!0},u=d3.dispatch("click","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","touchcancel","touchend","touchmove","touchstart");return t.width=function(r){return arguments.length?(n=r,t):n},t.height=function(r){return arguments.length?(e=r,t):e},t.innerRadiusCoef=function(r){return arguments.length?(a=r,t):a},t.scale=function(r){return arguments.length?(o=r,t):o},t.enter={smallToBig:function(r){return arguments.length?(i.smallToBig=r,t.enter):i.smallToBig},fromCenter:function(r){return arguments.length?(i.fromCenter=r,t.enter):i.fromCenter}},t.exit={bigToSmall:function(r){return arguments.length?(l.bigToSmall=r,t.exit):l.bigToSmall},toCenter:function(r){return arguments.length?(l.toCenter=r,t.exit):l.toCenter}},t.on=function(t,r){u.on(t,r)},t};